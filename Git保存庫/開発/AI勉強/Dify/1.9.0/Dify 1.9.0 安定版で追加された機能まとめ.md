## Dify 1.9.で追加された機能

Dify 1.9.0では、**ナレッジパイプライン**と**キューベースのグラフエンジン**という2つの主要機能が追加されました。

- ナレッジパイプライン(Knowledge Pipeline)
- キューベースのグラフエンジン(Queue‑based Graph Engine)

## ナレッジパイプライン

### ナレッジパイプラインアーキテクチャ

ナレッジの項目に新しく「知識パイプラインから作成する」の項目が追加されています。これが新機能「ナレッジパイプライン」です。

![[スクリーンショット 2025-10-05 14.34.03.png]]

「空白のパイプライン」を押下すると以下のようにナレッジ用の、各ナレッジへの処理用のノードを登録できる画面が出てきます。これによって、これまでできなかった、よりカスタマイズできるデータソースの加工処理が可能になっています。

![[スクリーンショット 2025-10-05 14.35.53.png]]

「一般文書処理」などナレッジパイプライン用のテンプレートもいくつか用意されており、DSLファイルから他のパイプラインからのインポート/エクスポートも可能です。

![[スクリーンショット 2025-10-05 15.06.41.png]]

### カスタマイズ可能なデータソースとツール
これまで特定のツールからしか取り込めなかったデータソースが、以下のようにGoogle DriveやGithub、Dropboxなど、マーケットプレイスのデータソースプラグインを使用して取り込めるようになりました。

![[スクリーンショット 2025-10-05 14.53.27.png]]

プラグイン「データソース」のページ
![[スクリーンショット 2025-10-05 14.45.12.png]]

またデータ処理もプラグイン(ツール)、MCPなどが利用できるようになりました。

![[スクリーンショット 2025-10-05 15.20.39.png]]

プラグイン「ツール」のページ
![[スクリーンショット 2025-10-05 15.21.09.png]]

### 新しいチャンキング手法

ナレッジパイプラインでは、チャンク構造の種類に汎用、親に加えて新しく「Q&A」もあります。

![[スクリーンショット 2025-10-05 15.27.02 1.png]]

### 画像の抽出と検索
PDFやPPTなどから画像を抽出してURLとして保存し、テキストと画像の混在した応答を可能にする仕組みが導入されています。

![[スクリーンショット 2025-10-05 19.40.35.png]]

画像参照：https://github.com/langgenius/dify/releases/tag/1.9.0

###  🧪 テスト実行とデバッグのサポート

パイプラインを公開する前に、次の操作が実行できるようになっています。

-  単一のステップまたはノードを個別に実行する
- 中間変数を詳細に検査する 
- 変数インスペクターで文字列変数を Markdown としてプレビューする
### レガシーナレッジベースからのワンクリック移行
既存のナレッジ ベースも、以下画面にある「変換する」ボタンを押すことで、ナレッジベースパイプラインに変換することができます。

![[スクリーンショット 2025-10-05 19.49.50.png]]

「変換する」ボタン押下後

![[スクリーンショット 2025-10-05 20.11.33.png]]

## キュー駆動のグラフエンジン

キュー駆動グラフエンジンという、ワークフローの実行を管理する新しいエンジンが追加されました。これまでのワークフローでの並列分岐では、状態管理やエラー再現が困難でしたが、すべてのタスクを統合キュー(一つのキュー)で管理することで解決しています。
これによって、並列実行におけるエラーが削減されます。

特徴は、任意のノードから実行を開始できる柔軟性、複数ノードからのストリーミング出力を整理するResponseCoordinator、実行中のワークフローを外部制御できるCommandProcessorです。また、コアコードを変更せずに機能拡張できるプラグインレイヤーも提供します。

デフォルトで有効化されており、DEBUG=trueで詳細なログ表示が可能です。このエンジンは、パフォーマンス向上ではなく、並列分岐の安定性、実行状態の明確さ、エラーハンドリングの正確性に重点を置いており、複雑なワークフローをより制御可能でデバッグしやすくします。