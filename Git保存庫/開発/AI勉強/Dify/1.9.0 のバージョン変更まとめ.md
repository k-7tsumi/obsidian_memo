該当ページ：https://github.com/langgenius/dify/releases/tag/1.9.0

## 訳す

### 1.9.0 – 知識のオーケストレーションとワークフローの強化

#### 🚀 イントロダクション

Dify 1.9.0では、2つの主要な新機能を導入します：ナレッジパイプラインとキューベースのグラフエンジンです。
ナレッジパイプラインは、知識の取り込みと処理のためのモジュール化され拡張可能なワークフローを提供します。一方、キューベースのグラフエンジンは、ワークフローの実行をより堅牢かつ制御可能にします。これらの機能により、AIアプリケーションの構築とデバッグがよりスムーズに行えるようになると確信しており、皆様のご利用体験を通じて継続的な改善を図ってまいります。

### 📚ナレッジパイプライン

#### ✨イントロダクション

知識パイプライン向けの全く新しいオーケストレーションインターフェースにより、文書処理の設計と実行方法を再構築する根本的なアーキテクチャのアップグレードを導入します。これにより、よりモジュール化され柔軟なワークフローが実現され、ユーザーはパイプラインの各段階をオーケストレーションできるようになります。マーケットプレイスで入手可能な多様な強力なプラグインにより強化され、ユーザーは様々なデータソースや処理ツールを柔軟に統合できます。このアーキテクチャにより、スケーラビリティ、適応性、精度に対する企業の高まる要求を満たす、高度にカスタマイズされたドメイン特化型RAGソリューションの構築が可能となります。

#### ❓なぜそれが必要なのか？

これまで、DifyのRAGユーザーは実世界での導入において、不正確な知識検索や情報損失から、データ統合や拡張性の制限に至るまで、持続的な課題に直面してきました。主な課題点としては以下が挙げられます：

- 🔗 データソースの統合が制限されている 
- 🖼️ 表や画像などの重要な要素が欠落している 
- ✂️ チャンク化の結果が最適ではない

これらすべてが回答品質の低下を招き、モデルの全体的なパフォーマンスを阻害します。

これに対応するため、DifyにおけるRAGをオープンでモジュール式のアーキテクチャとして再構築しました。これにより、開発者、インテグレーター、ドメインエキスパートは、データ取り込みからチャンク保存・検索に至るまで、特定の要件に合わせた文書処理パイプラインを構築できるようになります。

#### 🛠️ コア機能

##### 🧩 ナレッジパイプラインアーキテクチャ

ナレッジパイプラインは、文書取り込みに特化した視覚的なノードベースのオーケストレーションシステムです。複雑な文書処理を自動化するカスタマイズ可能な方法を提供し、きめ細かい変換を可能にするとともに、生のコンテンツと構造化され検索可能な知識を結びつけます。開発者はパズルを組み立てるように段階的にワークフローを構築できるため、文書処理の監視や調整が容易になります。

- ⚡ 公式テンプレートですぐに始められます
- 🔄 DSL 経由でインポート/エクスポートすることでパイプラインをカスタマイズおよび共有でき、再利用性とコラボレーションが容易になります

##### 🔌 カスタマイズ可能なデータソースとツール

各ナレッジベースは複数のデータソースをサポートします。プラグインベースの取り込みフレームワークを通じて、ローカルファイル、オンライン文書、クラウドドライブ、ウェブクローラーをシームレスに統合できます。開発者は新しいデータソースプラグインでエコシステムを拡張できる一方、マーケットプレイスのプロセッサーが数式、スプレッドシート、画像解析などの特殊なユースケースを処理し、正確な取り込みと構造化された表現を保証します。

##### 🧾 新しいチャンキング戦略

新しいQ&Aプロセッサプラグインは、一般モードと親子モードに加え、Q&A構造もサポートします。これにより、検索精度とコンテキストの完全性のバランスを保ちながら、より多くのユースケースに対応できるようになります。

##### 🖼️ 画像の抽出と検索

複数の形式のドキュメントから画像を抽出し、ナレッジ ベースに URL として保存し、テキストと画像の混合出力を有効にして、LLM によって生成された回答を改善します。

##### 🧪 テスト実行とデバッグのサポート

パイプラインを公開する前に、次の操作を実行できます。

- ▶️ 単一のステップまたはノードを個別に実行する
- 🔍 中間変数を詳細に検査する 
- 👀 変数インスペクターで文字列変数を Markdown としてプレビューする

これにより、あらゆる段階で安全な反復とデバッグが可能になります。

##### 🔄 レガシーナレッジベースからのワンクリック移行

既存のナレッジ ベースを 1 回のアクションで Knowledge Pipeline アーキテクチャにシームレスに変換し、スムーズな移行と下位互換性を確保します。

#### 🌟 なぜそれが重要なのか

ナレッジパイプラインは、ナレッジマネジメントをより透明性が高く、デバッグ可能で、拡張性の高いものにします。これは最終形ではなく、マルチモーダル検索、人間が関与する協働、企業レベルのデータガバナンスといった将来の機能強化のための基盤です。皆様がこれをどのように活用し、フィードバックを共有されるか楽しみにしています。

### ⚙️ キューベースのグラフエンジン

#### ❓ なぜ必要なのか？

これまで、並列分岐を含むワークフローを設計すると、次のような問題が発生することが多かった。
- 🌀 分岐状態の管理とエラーの再現が困難 
- ❌ デバッグ情報が不十分
- 🧱 柔軟性に欠ける固定的な実行ロジック

これらの問題により、複雑なワークフローの使い勝手が低下していました。これを解決するために、キュースケジューリングを中心とした実行エンジンを再設計し、並列タスクの管理を改善しました。

#### 🛠️ コア機能

##### 📋 キュースケジューリングモデル
すべてのタスクは統合されたキューに入り、スケジューラが依存関係と順序を管理します。これにより、並列実行におけるエラーが削減され、トポロジがより直感的になります。

##### 🎯 柔軟な実行開始ポイント
実行はどのノードからでも開始でき、部分実行、再開、サブグラフ呼び出しをサポートします。

##### 🌊 ストリーム処理コンポーネント
新しい **ResponseCoordinator** は、トークンごとの LLM 生成や長時間実行タスクからのステージングされた結果など、複数のノードからのストリーミング出力を処理します。

##### 🕹️ コマンドメカニズム
**CommandProcessor** を使用すると、実行中にワークフローを一時停止、再開、または終了できるため、外部制御が可能になります。

##### 🧩 グラフエンジンレイヤー
コアコードを変更することなくエンジンの機能を拡張できる新しいプラグインレイヤー。状態の監視、コマンドの送信、カスタム監視のサポートが可能です。

#### Quickstart

1. **前提条件**
    - Dify バージョン: 1.9.0 以上 
2. **有効にする方法**
   - デフォルトで有効になっており、追加の設定は必要ありません。 
   - デバッグモード: DebugLoggingLayer を有効にするには、DEBUG=true を設定します。
- 実行制限：
	- `WORKFLOW_MAX_EXECUTION_STEPS=500`
	- `WORKFLOW_MAX_EXECUTION_TIME=1200`
	- `WORKFLOW_CALL_MAX_DEPTH=10`
- ワーカー構成（オプション）:
	-  `WORKFLOW_MIN_WORKERS=1`
	- `WORKFLOW_MAX_WORKERS=10`
	- `WORKFLOW_SCALE_UP_THRESHOLD=3`
	- `WORKFLOW_SCALE_DOWN_IDLE_TIME=30`
- すべてのワークフローに適用されます。

#### より制御可能な並列分岐
