- https://azure.microsoft.com/ja-jp/products/kubernetes-service
- ドキュメント：https://learn.microsoft.com/ja-jp/azure/aks/what-is-aks
- ”Kubernetes” の基本を徹底解説：https://qiita.com/tadashiro_ninomiya/items/6e6fea807b2a16732b5b

## TODO

- なんか作ってみる。
  - これで学習してみる？：https://learn.microsoft.com/ja-jp/training/paths/intro-to-kubernetes-on-azure/

## 学習トレーニングを進める。

- https://learn.microsoft.com/ja-jp/training/paths/intro-to-kubernetes-on-azure/

- デーモンとは：https://qiita.com/yuta_931214/items/19ffad86cdfdd5bf37dc
- コンテナー OS は、ホスト OS から分離されている、アプリケーションをデプロイして実行する環境です。
- scratch とは、超最小化されたベースイメージのよう。
- apt とは：https://weblabo.oscasierra.net/ubuntu-apt/
- コンテナーでは、データを永続化するために 2 つのオプションを使用できます。 1 つ目のオプションは "_ボリューム_" を使用するもので、2 つ目のオプションは "_バインド マウント_" です。
- Docker のボリュームとは：https://qiita.com/gounx2/items/23b0dc8b8b95cc629f32
- コンテナのポートを公開するには、docker run コマンドで  `--publish`  フラグ（短縮形は  `-p` ） を使います。 `--publish`  命令は  `[host port]:[container port]`  形式です。そのため、コンテナ外のポート 3000 に コンテナ内のポート 8000 を公開するには、 --publish フラグに 3000:8000 を渡します。
  - https://docs.docker.jp/language/nodejs/run-containers.html
- コンテナをデプロイできる azure のサービス：Azure Container Instances、Azure App Service、Azure Kubernetes Service
- Linuxとか、Ubuntuとか、その辺りの用語に対する全般的な勉強をしたい。。
- Azure Container Registry：https://learn.microsoft.com/ja-jp/azure/container-registry/container-registry-intro
	- 作成する Azure コンテナー レジストリ リソースはそれぞれ、一意の URL を持つ個別のレジストリです。
- AzureCLIのインストール：https://learn.microsoft.com/ja-jp/cli/azure/install-azure-cli-macos?view=azure-cli-latest
- コンテナまだ作れていない。

```
$az acr create --name k7tsumihotelreservationsystem --resource-group katakura_resource_group --sku standard --admin-enabled true

(MissingSubscriptionRegistration) The subscription is not registered to use namespace 'Microsoft.ContainerRegistry'. See https://aka.ms/rps-not-found for how to register subscriptions.

Code: MissingSubscriptionRegistration

Message: The subscription is not registered to use namespace 'Microsoft.ContainerRegistry'. See https://aka.ms/rps-not-found for how to register subscriptions.

Exception Details: (MissingSubscriptionRegistration) The subscription is not registered to use namespace 'Microsoft.ContainerRegistry'. See https://aka.ms/rps-not-found for how to register subscriptions.

Code: MissingSubscriptionRegistration

Message: The subscription is not registered to use namespace 'Microsoft.ContainerRegistry'. See https://aka.ms/rps-not-found for how to register subscriptions.

Target: Microsoft.ContainerRegistry
```

- リソース プロバイダー登録のエラーを解決する：https://learn.microsoft.com/ja-jp/azure/azure-resource-manager/troubleshooting/error-register-resource-provider?tabs=azure-cli
- リソースプロバイダとは：https://learn.microsoft.com/ja-jp/azure/azure-resource-manager/management/resource-providers-and-types
- 「リソースプロバイダーはサブスクリプションに登録されていない」という旨のエラーが出てVMが作成できない：https://qiita.com/tajirit/items/ccfa6ff40e706c2ca5ea
- リソースプロバイダに登録されていない。(リソースプロバイダってなに。)
```
$az provider list --output table | grep Microsoft.ContainerRegistry

Microsoft.ContainerRegistry                              RegistrationRequired  NotRegistered
```
- リソースプロバイダに登録後コンテナを作成できた。

```
$az provider register --namespace Microsoft.ContainerRegistry

Registering is still on-going. You can monitor using 'az provider show -n Microsoft.ContainerRegistry'

$az provider list --query "[?namespace=='Microsoft.ContainerRegistry']" --output table

Namespace                    RegistrationState    RegistrationPolicy

---------------------------  -------------------  --------------------

Microsoft.ContainerRegistry  Registered           RegistrationRequired

$az acr create --name k7tsumihotelreservationsystem --resource-group katakura_resource_group --sku standard --admin-enabled true
{
  "adminUserEnabled": true,
  "anonymousPullEnabled": false,
  "autoGeneratedDomainNameLabelScope": "Unsecure",
  "creationDate": "2025-09-16T08:34:35.097058+00:00",
  "dataEndpointEnabled": false,
  "dataEndpointHostNames": [],
  "encryption": {
    "keyVaultProperties": null,
    "status": "disabled"
  },
  "id": "/subscriptions/b3c720dd-5446-4d55-ac42-013e165e638a/resourceGroups/katakura_resource_group/providers/Microsoft.ContainerRegistry/registries/k7tsumihotelreservationsystem",
  "identity": null,
  "location": "japaneast",
  "loginServer": "k7tsumihotelreservationsystem.azurecr.io",
  "metadataSearch": "Disabled",
  "name": "k7tsumihotelreservationsystem",
  "networkRuleBypassOptions": "AzureServices",
  "networkRuleSet": null,
  "policies": {
    "azureAdAuthenticationAsArmPolicy": {
      "status": "enabled"
    },
    "exportPolicy": {
      "status": "enabled"
    },
    "quarantinePolicy": {
      "status": "disabled"
    },
    "retentionPolicy": {
      "days": 7,
      "lastUpdatedTime": "2025-09-16T08:34:50.393420+00:00",
      "status": "disabled"
    },
    "softDeletePolicy": {
      "lastUpdatedTime": "2025-09-16T08:34:50.393481+00:00",
      "retentionDays": 7,
      "status": "disabled"
    },
    "trustPolicy": {
      "status": "disabled",
      "type": "Notary"
    }
  },
  "privateEndpointConnections": [],
  "provisioningState": "Succeeded",
  "publicNetworkAccess": "Enabled",
  "resourceGroup": "katakura_resource_group",
  "roleAssignmentMode": "LegacyRegistryPermissions",
  "sku": {
    "name": "Standard",
    "tier": "Standard"
  },
  "status": null,
  "systemData": {
    "createdAt": "2025-09-16T08:34:35.097058+00:00",
    "createdBy": "koohiiko77@gmail.com",
    "createdByType": "User",
    "lastModifiedAt": "2025-09-16T08:34:35.097058+00:00",
    "lastModifiedBy": "koohiiko77@gmail.com",
    "lastModifiedByType": "User"
  },
  "tags": {},
  "type": "Microsoft.ContainerRegistry/registries",
  "zoneRedundancy": "Disabled"

}
```

- SKU = 複数のサービス階層
	- https://learn.microsoft.com/ja-jp/azure/container-registry/container-registry-skus
- docker login：https://docs.docker.jp/engine/reference/commandline/login.html
- タグ指定できてる。

```
$docker tag reservationsystem k7tsumihotelreservationsystem.azurecr.io/reservationsystem:v2

$docker images

REPOSITORY                                                   TAG           IMAGE ID       CREATED         SIZE

reservationsystem                                            latest        6d2eddc43195   2 days ago      1.87GB

k7tsumihotelreservationsystem.azurecr.io/reservationsystem   v2            6d2eddc43195   2 days ago      1.87GB
```

- az containerコマンド： https://learn.microsoft.com/ja-jp/cli/azure/container?view=azure-cli-latest
- Azure Container Instances: https://azure.microsoft.com/ja-jp/products/container-instances

コンテナが作られた。
```
$az container create --resource-group katakura_resource_group --name reservationsysteminstance --image k7tsumihotelreservationsysem.azurecr.io/reservationsystem:v2 --dns-name-label reservationsystem --registry-username k7tsumihotelreservationsystem --registry-password ×××××× --os-type Linux --cpu 1 --memory 1

{
  "confidentialComputeProperties": null,
  "containerGroupProfile": null,
  "containers": [
    {
      "command": null,
      "configMap": {
        "keyValuePairs": {}
      },
      "environmentVariables": [],
      "image": "k7tsumihotelreservationsystem.azurecr.io/reservationsystem:v2",
      "instanceView": {
        "currentState": {
          "detailStatus": "",
          "exitCode": null,
          "finishTime": null,
          "startTime": "2025-09-18T07:20:46.383000+00:00",
          "state": "Running"
        },
        "events": [
          {
            "count": 1,
            "firstTimestamp": "2025-09-18T07:19:54+00:00",
            "lastTimestamp": "2025-09-18T07:19:54+00:00",
            "message": "pulling image \"k7tsumihotelreservationsystem.azurecr.io/reservationsystem@sha256:0ee8b57a01bcf858c7fe2671f250678700ba149d59be395f4d523841e2a15e9b\"",
            "name": "Pulling",
            "type": "Normal"
          },
          {
            "count": 1,
            "firstTimestamp": "2025-09-18T07:20:36+00:00",
            "lastTimestamp": "2025-09-18T07:20:36+00:00",
            "message": "Successfully pulled image \"k7tsumihotelreservationsystem.azurecr.io/reservationsystem@sha256:0ee8b57a01bcf858c7fe2671f250678700ba149d59be395f4d523841e2a15e9b\"",
            "name": "Pulled",
            "type": "Normal"
          },
          {
            "count": 1,
            "firstTimestamp": "2025-09-18T07:20:46+00:00",
            "lastTimestamp": "2025-09-18T07:20:46+00:00",
            "message": "Started container",
            "name": "Started",
            "type": "Normal"
          }
        ],
        "previousState": null,
        "restartCount": 0
      },
      "livenessProbe": null,
      "name": "reservationsysteminstance",
      "ports": [
        {
          "port": 80,
          "protocol": "TCP"
        }
      ],
      "readinessProbe": null,
      "resources": {
        "limits": null,
        "requests": {
          "cpu": 1.0,
          "gpu": null,
          "memoryInGb": 1.0
        }
      },
      "securityContext": null,
      "volumeMounts": null
    }
  ],
  "diagnostics": null,
  "dnsConfig": null,
  "encryptionProperties": null,
  "extensions": null,
  "id": "/subscriptions/b3c720dd-5446-4d55-ac42-013e165e638a/resourceGroups/katakura_resource_group/providers/Microsoft.ContainerInstance/containerGroups/reservationsysteminstance",
  "identity": null,
  "imageRegistryCredentials": [
    {
      "identity": null
      "identityUrl": null,
      "isDelegatedIdentity": false,
      "password": null,
      "server": "k7tsumihotelreservationsystem.azurecr.io",
      "username": "k7tsumihotelreservationsystem"
    }
  ],
  "initContainers": [],
  "instanceView": {
    "events": [],
    "state": "Running"
  },
  "ipAddress": {
    "autoGeneratedDomainNameLabelScope": "Unsecure",
    "dnsNameLabel": "reservationsystem",
    "fqdn": "reservationsystem.japaneast.azurecontainer.io",
    "ip": "130.33.165.206",
    "ports": [
      {
        "port": 80,
        "protocol": "TCP"
      }
    ],
    "type": "Public"
  },
  "isCreatedFromStandbyPool": false,
  "location": "japaneast",
  "name": "reservationsysteminstance",
  "osType": "Linux",
  "priority": null,
  "provisioningState": "Succeeded",
  "resourceGroup": "katakura_resource_group",
  "restartPolicy": null,
  "sku": "Standard",
  "standbyPoolProfile": null,
  "subnetIds": null,
  "tags": {},
  "type": "Microsoft.ContainerInstance/containerGroups",
  "volumes": null,
  "zones": null
}
```
- IPアドレスはこれ？
```
$az container show --resource-group katakura_resource_group --name reservationsysteminstance --query ipAddress.fqdn

"reservationsystem.japaneast.azurecontainer.io"
```
コンテナー インスタンスで確認できた。：https://portal.azure.com/#browse/Microsoft.ContainerInstance%2FcontainerGroups

- 1日で146円くらいかかっていて、高いので、安いリージョンと容量でできないか確認する。
- Azure Resource Mover: https://learn.microsoft.com/ja-jp/azure/resource-mover/overview

-  次はこれをやる：https://learn.microsoft.com/ja-jp/training/modules/intro-to-kubernetes/