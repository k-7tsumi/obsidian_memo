- マーケットプレイスのサイト：https://marketplace.dify.ai/plugins/kalochin/think?source=https%253A%252F%252Fcloud.dify.ai&language=ja-JP&theme=system
- リポジトリ：https://github.com/fdb02983rhy/dify-think-plugin

## ざっくり概要
- Difyの**thinkプラグイン**は、LLMが複雑なタスクを処理する際に「思考用のメモ帳」として機能するもの。
- LLMの思考プロセス全体のための作業スペース(考えを整理し、計画を立て、チェックし、 次の行動を決めるための作業スペース)
## どんな時に使用するのがいい？
1. **複数ツールの結果を分析・評価する時**
	1. 例： データベース検索 → 結果を評価 → 次の検索条件を決定
2. **厳格なルール・規制がある時**(それらをチェックしたい時)
	1. 例：個人情報保護法の遵守チェック、金融取引の規制確認、医療情報の取り扱いルール検証、企業の経費申請ポリシー確認
3. **多段階の意思決定プロセス時**
	1. 例：ステップ1 → ステップ2 → ステップ3...

## どんな時に使用しない方がいい？
1. 単純なツール操作や、制約が少ない or 簡単なタスク
	1. 理由：思考プロセスが不要、トークンの無駄に使ってしまうから。
	2. 例：「現在時刻は？」など時刻取得APIを呼ぶだけ
2. **並列的なツール操作**
	1. 各操作が独立しているため、推論の必要がないから。
	2. 例：複数の独立したデータソースから情報取得

## Thinkツール使うかの判断基準

判断基準
```
質問：このタスクは複雑？
  ↓ NO → Thinkツール不要
  ↓ YES
  
質問：複数のステップがある？
  ↓ NO → Thinkツール不要
  ↓ YES
  
質問：各ステップが次に影響する？
  ↓ NO → Thinkツール不要
  ↓ YES
  
質問：厳格なルールや規制がある？
  ↓ YES → ✅ Thinkツール使用推奨！
  ↓ NO
  
質問：前の結果を評価してから次に進む？
  ↓ YES → ✅ Thinkツール使用推奨！
  ↓ NO → Thinkツール不要
```


## README翻訳( https://github.com/fdb02983rhy/dify-think-plugin )

#### 説明
「think」ツールは、複雑なタスク遂行時にLLMが構造化された思考を行うための専用領域を創出します。このツールは、複雑な状況における推論のためのサンドボックスを提供することで、LLMの問題解決能力を強化します。

複数のツールを使用する場合や多段階の意思決定を行う場合、LLMは情報を分析し、ポリシー遵守を確認し、連続した行動を計画する場を持つことで恩恵を受けます。「think」ツールは、新たな情報を取得したりデータを変更したりすることなく、思考プロセスを記録するだけでこの空間を提供します。

本ツールはAnthropicの「think」ツール研究に着想を得た簡易実装です。詳細は以下をご参照ください：https://www.anthropic.com/engineering/claude-think-tool

#### thinkツール活用の最適シナリオ
調査とテストにより、シンクツールは以下の主要シナリオにおいて顕著な利点を提供することが示されています：

1. ツール結果の分析：特にLLMが戦略調整が必要な状況において、次の処理に進む前に過去のツール呼び出し結果を慎重に評価する必要がある場合に有用です。

2. 規制・ガイドライン遵守：厳格なポリシーや複雑な規制を厳密に順守・検証する必要がある状況において不可欠。

3. 多段階意思決定プロセス：行動が順次構築され、各決定が後続の選択肢に影響を与え、誤りが連鎖的な結果を招く可能性があるシナリオで最も効果を発揮する。

#### 効果的な実装戦略
LLM実装において思考ツールの効果を最大化するには：

1. コンテキスト固有の例を作成する 次のことを示すカスタマイズされた例を開発します。:

- ユースケースに適した推論の深さ
- 複雑なタスクを分解する手法
- 一般的なシナリオに対処するフレームワーク
- 包括的な情報収集を確保する方法

2. システム指示への詳細なガイダンスの統合 複雑な実装では、ツールの説明ではなくシステムプロンプト内に包括的な思考ツールの指示を組み込みます。このアプローチにより、LLMが構造化された思考を問題解決プロセス全体に効果的に組み込めるようになります。

#### 思考ツールの制限とスキップする場合
thinkツールには制限があり、すべてのシナリオでメリットがあるわけではありません。導入を検討する際には、追加のトークンの使用を考慮してください。このツールは以下の場合に最小限のメリットしか提供しません。

- **単純なツール操作または並列ツール操作:** 単一のツール呼び出しのみ、または非連続的な複数のツール操作を必要とするユースケースでは、通常、追加のリフレクションによるメリットは得られません。
- **簡単なタスク実行:** 制約が最小限のシナリオ、または LLM の標準的な推論が現在のタスクに対してすでに十分な場合。

#### 実装ガイド
以下の手順に従って、思考ツールを LLM 環境に組み込みます。

1. **複雑なシナリオから始める:** LLM が現在ポリシーのコンプライアンスや複雑な推論チェーンで困難を経験している困難なユースケースを特定します。
2. **ドメイン用のツールを構成する:** システム手順に関連する例やユースケースを含め、ニーズに合わせてカスタマイズされた思考ツールを実装します。
3. **評価と調整:** LLM が実際のシナリオでツールをどのように活用しているかを観察し、より効果的な推論パターンを促進するように実装を改良します。

#### 適切な促しで利益を最大化する
思考ツールを最大限に活用するには、いつどのように使用するかについての具体的な指示をシステム プロンプトに追加することを検討してください。

```
## thinkツールの使用

ツール結果を受け取った後、ユーザーに対応する前に、thinkツールをメモ帳として活用し以下のことを行います：
- 現在のリクエストに適用される具体的なルールを列挙する
- 必要な情報が全て収集されているか確認する
- 計画したアクションが全てのポリシーに準拠していることを検証する
- ツール結果を繰り返し検証し正確性を確認する

thinkツール内で反復検証すべき内容の例：
<think_tool_example_1>
ユーザーが[具体的なシナリオ]を希望
- 確認事項：[主要情報]
- 関連ルールの確認：[ルール一覧]
- [重要条件]の検証
- 計画：[手順の概要]
</think_tool_example_1>
プロンプトにドメイン固有の例を含めることで、LLMによる思考ツールの有効活用が大幅に向上します。具体的なユースケースに合わせた例を含めることを検討してください。
```